/*!
 * WooCommerce Bulk Variations 2.1.5
 * Copyright 2022 Barn2 Plugins
 */
!function(e,a,t,i,o,l){"use strict";const r=(()=>{let r=!1,n=!1;const s=()=>{if(r)return!1;e("#field_to_edit option").each(((a,t)=>{e(t).data("global")||e(t).attr("data-action",e(t).val()).val(e(t).val()+"_selected")})),e("a.button.bulk_edit.do_variation_action").after(e("<label>",{class:"bulk-actions-filtered-only",disabled:""}).append(e("<input>",{id:"wcbvp_bulk_actions_filtered_only",name:"wcbvp_bulk_actions_filtered_only",type:"checkbox"}),e("<span>").text(o.bulk_actions_filtered_only))),e("#field_to_edit").before(e("<div>",{class:"wcbvp-bulk-actions-group"})),e(".wcbvp-bulk-actions-group").append(e("#field_to_edit, a.button.bulk_edit.do_variation_action, label.bulk-actions-filtered-only").detach()).parent().after(e("#variation_filters").show().detach());const a=e('#field_to_edit option[data-action="delete_all"]');a.attr("data-label",a.text()),c(),r=!0},c=()=>{_(),e(t).on("change","#variation_filters select.wcbvp-attribute-filters",{newFilters:!0},h).on("click","#variation_filters a.update_filters",{newFilters:!0},h).on("click","#variation_filters a.reset_filters",v).on("click","#variation_filters a.add_filter",y).on("keypress","#variation_filters :input",k).on("change",".variations-pagenav .page-selector",{isRelative:!1},O).on("click",".variations-pagenav .first-page",{page:1},O).on("click",".variations-pagenav .prev-page",{page:-1,isRelative:!0},O).on("click",".variations-pagenav .next-page",{page:1,isRelative:!0},O).on("click",".variations-pagenav .last-page",{page:1/0},O).on("click","#variable_product_options button.save-variation-changes",$).on("change","input#wcbvp_bulk_actions_filtered_only",w).on("click","a.button.additional-filters",(()=>e(".wcbvp-additional-filters").slideToggle())).on("click","button.wcbvp-remove-filter-item",x).on("change","#wcbvp_additional_filters select.filter-meta-key",C).on("change","#wcbvp_additional_filters select.filter-compare",j);let a=["delete_all","toggle_enabled","variable_regular_price","variable_regular_price_increase","variable_regular_price_decrease","variable_sale_price","variable_sale_price_increase","variable_sale_price_decrease","variable_sale_schedule","variable_stock","variable_low_stock_amount","variable_download_limit","variable_download_expiry","variable_length","variable_width","variable_height","variable_weight","variable_set_thumbnail","variable_remove_thumbnail","toggle_downloadable","toggle_virtual","toggle_manage_stock","variable_stock_status_instock","variable_stock_status_outofstock","variable_stock_status_discontinued","variable_stock_status_onbackorder"];const i=e(t).triggerHandler("wcbvp.getVariationActions",[a]);l!==i&&(a=i);for(const t of a)e("select.variation_actions").off(t+"_selected_ajax_data").on(t+"_selected_ajax_data",{action:t},m)},_=()=>{e(t.body).off("change",".variations-pagenav .page-selector").off("click",".variations-pagenav .first-page").off("click",".variations-pagenav .prev-page").off("click",".variations-pagenav .next-page").off("click",".variations-pagenav .last-page"),e("#variable_product_options").off("click","button.save-variation-changes")},d=()=>{e("#woocommerce-product-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},p=()=>{e("#woocommerce-product-data").unblock()},v=()=>{e("#variable_product_options .variations-pagenav").show(),e("#variation_filters select.wcbvp-attribute-filters").val(""),e("#variation_filters .wcbvp-filter-item").remove(),e("label.bulk-actions-filtered-only").attr("disabled",""),e("input#wcbvp_bulk_actions_filtered_only").prop("checked",!1).trigger("change"),g({data:{newFilters:!0}})},m=r=>{const s=r.data.action.replace(/toggle_|variable_|_selected|/gi,"");let c,_=r.data;switch(_.per_page=-1,_.page=1,_.product_id=woocommerce_admin_meta_boxes_variations.post_id,_.filters={},n&&(_.filters=u()),s){case"delete_all":a.confirm(o.warning_delete_filtered_variations)&&a.confirm(woocommerce_admin_meta_boxes_variations.i18n_last_warning)&&(_.allowed=!0);break;case"regular_price":case"sale_price":case"stock":case"low_stock_amount":case"download_limit":case"download_expiry":case"length":case"width":case"height":case"weight":c=a.prompt(woocommerce_admin_meta_boxes_variations.i18n_enter_a_value),null!=c?_.value=c:_=null;break;case"regular_price_increase":case"regular_price_decrease":case"sale_price_increase":case"sale_price_decrease":c=a.prompt(woocommerce_admin_meta_boxes_variations.i18n_enter_a_value_fixed_or_percent),null!=c?c.indexOf("%")>=0?_.value=accounting.unformat(c.replace(/\%/,""),woocommerce_admin.mon_decimal_point)+"%":_.value=accounting.unformat(c,woocommerce_admin.mon_decimal_point):_=null;break;case"sale_schedule":_.date_from=a.prompt(woocommerce_admin_meta_boxes_variations.i18n_scheduled_sale_start),_.date_to=a.prompt(woocommerce_admin_meta_boxes_variations.i18n_scheduled_sale_end),null===_.date_from&&(_.date_from=!1),null===_.date_to&&(_.date_to=!1),!1===_.date_to&&!1===_.date_from&&(_=null);break;case"remove_thumbnail":a.confirm(o.warning_remove_thumbnails)&&a.confirm(woocommerce_admin_meta_boxes_variations.i18n_last_warning)?_.allowed=!0:_=null;break;case"set_thumbnail":_=null;const n=i.media({frame:"select",multiple:!1,title:o.wp_media_title,library:{type:"image"},button:{text:o.wp_media_button}});n.on("select",(()=>{d();const a=n.state().get("selection").first().toJSON(),t=r.data;t.thumbnail_id=a.id,e.ajax({url:woocommerce_admin_meta_boxes_variations.ajax_url,data:{action:"woocommerce_bulk_edit_variations",security:woocommerce_admin_meta_boxes_variations.bulk_edit_variations_nonce,product_id:woocommerce_admin_meta_boxes_variations.post_id,product_type:e("#product-type").val(),bulk_action:"variable_set_thumbnail_selected",data:t},type:"POST",success:function(){g()}})})),n.open();break;default:const s=e(t).triggerHandler("wcbvp.doVariationActions",[_]);l!==s&&(_=s)}return _},u=()=>{const a={attributes:{},meta:[]};return e("#variation_filters select.wcbvp-attribute-filters").toArray().map((e=>{e.value&&(a.attributes[e.dataset.attribute_name]=e.value)})),e("#variation_filters .wcbvp-filter-item:not(.editing)").each(((t,i)=>{const o=e(i),l=e(".filter-meta-key",o),r=e(".filter-compare option:selected",o),n=e("input.wcbvp-filter-value",o).val(),s=e("input.wcbvp-filter-second-value",o).val(),c={key:l.val(),compare:r.val()};0<r.data("values")&&(c.value=n),1<r.data("values")&&(c.value2=s),"_stock_status"===c.key&&(c.value=e("select.stock-status-options",o).val()),a.meta.push(c)})),a},g=a=>{const t=a&&a.data&&a.data.newFilters?1:S().data("page"),i=woocommerce_admin_meta_boxes_variations.variations_per_page;d();const o=u(),l=Object.values(o).map((e=>Object.values(e).length)).filter((e=>e)).length>0;e("a.reset_filters").toggleClass("hidden",!l),e("label.bulk-actions-filtered-only").attr("disabled",l?null:""),e("input#wcbvp_bulk_actions_filtered_only").prop("checked",n&&l).trigger("change"),e.ajax({url:woocommerce_admin_meta_boxes_variations.ajax_url,data:{action:"wcbvp_load_variations",security:woocommerce_admin_meta_boxes_variations.load_variations_nonce,product_id:woocommerce_admin_meta_boxes_variations.post_id,filters:o,page:t,per_page:i},type:"POST",success:a=>{S().empty().append(a.data.html),F(a.data.count,a.data.total),T(),e("#woocommerce-product-data").trigger("woocommerce_variations_loaded")},complete:()=>{p()}})},b=(e,a,t)=>{if(!t||!t.data)return!1;const i=f(Object.fromEntries(t.data.replace(/%5B/gi,"[").replace(/%5D/gi,"]").split("&").map((e=>e.split("=")))));if(i){if("woocommerce_bulk_edit_variations"===i.action){const e=i.data;e&&"delete_all"===e.action&&"true"===e.allowed&&v()}r||"woocommerce_load_variations"!==i.action||s()}},f=e=>{const a=/^(\w+)\[(\w+)\](.*)$/;return Object.keys(e).reduce(((t,i)=>{let o=i.match(a);if(o&&o.length>=3){let[a,l,r=""]=o.slice(1);t[a]=Object.assign({},t[a],f({[l+r]:e[i]}))}else t[i]=e[i];return t}),{})},w=a=>{const t=e(a.currentTarget),i=e('#field_to_edit option[data-action="delete_all"]');n=e(a.currentTarget).prop("checked"),i.text(t.prop("checked")?o.delete_filtered_variations:i.attr("data-label"))},h=a=>{n=!0,0===e(".wcbvp-filter-item").length&&e("#variation_filters").removeClass("changed"),g({data:{newFilters:!0}})},k=e=>{if(13==e.keyCode)return h(e),!1},y=a=>{const t=e(a.currentTarget).closest(".wcbvp-filter-items-toolbar"),o=i.template("wcbvp-filter-item"),l=e(o()).hide();t.before(l),e(".wcbvp-filter-value, .wcbvp-filter-second-value, .stock-status-options",l).hide(),l.slideToggle(250),e(".filter-meta-key",l).trigger("change"),e("#variation_filters").addClass("changed")},x=a=>{const t=e(a.currentTarget).closest(".wcbvp-filter-item");t.slideToggle(250,(()=>{t.remove(),e("#variation_filters").addClass("changed")}))},C=a=>{const t=e(a.currentTarget),i=e("option:selected",t),l=t.closest(".wcbvp-filter-item"),r=e("select.filter-compare",l),n=e("option",r).filter(((a,t)=>!e(t).val()||e(t).data("type").split(",").includes(i.data("type"))));if(e("option",r).prop("hidden",!0),n.prop("hidden",!1),r.prop("disabled",0===n.length),e("select.stock-status-options",l).addClass("hidden").next(".select2").addClass("hidden"),"_stock_status"===t.val()&&e().selectWoo){const a=()=>{e("select.stock-status-options",l).selectWoo({placeholder:o.select_stock_status_placeholder,multiple:!0,width:"auto",allowClear:!0,closeOnSelect:!1})};e("select.stock-status-options",l).removeClass("hidden").next(".select2").removeClass("hidden"),a()}if(0===n.length)return!1;r.get(0).selectedIndex=n.get(0).index,r.trigger("change")},j=a=>{const t=e(a.currentTarget),i=t.closest(".wcbvp-filter-item"),o=e(".filter-meta-key",i),l=e("option:selected",o),r=l.data("type"),n=l.data("placeholder"),s=e("option:checked",t).data("values");e(".wcbvp-filter-value",i).attr({type:r,placeholder:n}).toggle(s>0),e(".wcbvp-filter-second-value",i).attr({type:r,placeholder:n}).toggle(s>1)},O=e=>(T(e.data),g(),!1),T=a=>{let t=Number(e(".variations-pagenav .page-selector").val());const i=S().data("total_pages"),o=S().data("page");if(a){const l=a.page||t;t=a.isRelative?Math.min(i,Math.max(1,o+l)):Math.min(l,i),e(".variations-pagenav .page-selector").val(t)}S().data("page",t).attr("data-page",t),e(".variations-pagenav .pagination-links").toggleClass("hidden",i<2),e(".variations-pagenav .page-selector").toggleClass("disabled",i<2),e(".variations-pagenav a.first-page, .variations-pagenav a.prev-page").toggleClass("disabled",1===t),e(".variations-pagenav a.next-page, .variations-pagenav a.last-page").toggleClass("disabled",t===i)},S=()=>e("#variable_product_options").find(".woocommerce_variations"),F=(a,t)=>{const i=e(".variations-pagenav .displaying-num"),l=Math.ceil(a/Number(woocommerce_admin_meta_boxes_variations.variations_per_page));e(".variations-pagenav .total-pages").text(l),e(".variations-pagenav .pagination-links").toggleClass("hidden",l<2),S().data("count",a).attr("data-count",a),S().data("total",t).attr("data-total",a),S().data("total_pages",l).attr("data-total",a);const r=e(".variations-pagenav .page-selector").val()||1;e(".variations-pagenav .page-selector").empty().val(""),l>1&&e(".variations-pagenav .page-selector").each(((a,t)=>{e(t).append(Array(l).fill(1).map(((e,a)=>`<option value="${a+1}">${a+1}</option>`))),t.value=r}));const n=`<strong>${a}</strong>`;let s=woocommerce_admin_meta_boxes_variations.i18n_variation_count_single.replace("%qty%",`<strong>${t}</strong>`);if(t>1&&(s=woocommerce_admin_meta_boxes_variations.i18n_variation_count_plural.replace("%qty%",`<strong>${t}</strong>`)),a===t)i.html(s);else{const e=1===a?o.filter_singular_result:o.filter_results;i.html(e.replace("%count%",n).replace("%totals%",s))}return a},$=()=>{const a=e("#variable_product_options").find(".woocommerce_variations"),t=e(".variation-needs-update",a);let i={};0<t.length&&(d(),i=(a=>{var t=e(":input",a).serializeJSON();return e(".variations-defaults select").each((function(a,i){var o=e(i);t[o.attr("name")]=o.val()})),t})(t),i.action="woocommerce_save_variations",i.security=woocommerce_admin_meta_boxes_variations.save_variations_nonce,i.product_id=woocommerce_admin_meta_boxes_variations.post_id,i["product-type"]=e("#product-type").val(),e.ajax({url:woocommerce_admin_meta_boxes_variations.ajax_url,data:i,type:"POST",success:function(a){t.removeClass("variation-needs-update"),e("button.cancel-variation-changes, button.save-variation-changes").attr("disabled","disabled"),e("#woocommerce-product-data").trigger("woocommerce_variations_saved"),g()}}))};return{initialize:()=>{e("#variation_filters").hide(),e(t).ajaxComplete(b)},block:d,unblock:p,setPage:O,resetFilters:v}})();a.WCBulkVariationManager=r,e((()=>{r.initialize()}))}(jQuery,window,document,wp,wcbvp_manager_translations);