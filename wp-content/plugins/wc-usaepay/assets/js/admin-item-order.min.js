!function(a){"use strict";jQuery(document).ready(function(a){a(".usaepaytransapi_subtotal").closest("tr").prev().remove();a("body").on("click",".usaepaytransapi_capture_subtotal_btn",function(b){b.preventDefault();var c=window.prompt("Please input the new Subtotal");if(null!=c){a("#woocommerce-order-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var d="",e="",f="",g="";"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(d=a("#_shipping_country").val(),e=a("#_shipping_state").val(),f=a("#_shipping_postcode").val(),g=a("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&d||(d=a("#_billing_country").val(),e=a("#_billing_state").val(),f=a("#_billing_postcode").val(),g=a("#_billing_city").val());var h={action:"woocommerce_add_new_subtotal",orderId:a(this).attr("data-order-id"),itemId:a(this).attr("data-item-id"),osubtotal:a(this).attr("data-osubtotal"),security:order_line_totals.new_subtotal_nonce};a.ajax({url:order_line_totals.ajax_url,data:h,type:"POST",success:function(a){},complete:function(){var b={country:d,state:e,postcode:f,city:g,action:"woocommerce_calc_line_taxes",order_id:woocommerce_admin_meta_boxes.post_id,items:a("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),security:woocommerce_admin_meta_boxes.calc_totals_nonce};a(document.body).trigger("order-totals-recalculate-before",b),a.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:b,type:"POST",success:function(b){a("#woocommerce-order-items").find(".inside").empty(),a("#woocommerce-order-items").find(".inside").append(b),a(document.body).trigger("order-totals-recalculate-success",b)},complete:function(b){a(document.body).trigger("order-totals-recalculate-complete",b);var h=a("#order_line_items tr.item").find(".woocommerce-Price-currencySymbol"),i=a(".usaepaytransapi_subtotal");i.html(""),i.append('<span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">'+h.html()+"</span>"+c+"</span>");var j=a("#order_line_items tr.item").find(".line_subtotal.wc_input_price");j.length;j.each(function(b){var c=a(this);a(c).attr("value",0)});var k=a("#order_line_items tr.item").find(".line_total"),l=k.length;k.each(function(b){var d=a(this),e=l-1;0==l?a(d).attr("value",c):b==e?a(d).attr("value",c):a(d).attr("value",0)});var m={country:d,state:e,postcode:f,city:g,action:"woocommerce_calc_line_taxes",order_id:woocommerce_admin_meta_boxes.post_id,items:a("table.woocommerce_order_items :input[name], .wc-order-totals-items :input[name]").serialize(),security:woocommerce_admin_meta_boxes.calc_totals_nonce};a(document.body).trigger("order-totals-recalculate-before",m),a.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:m,type:"POST",success:function(b){a("#woocommerce-order-items").find(".inside").empty(),a("#woocommerce-order-items").find(".inside").append(b),a(document.body).trigger("order-totals-recalculate-success",b)},complete:function(b){a(document.body).trigger("order-totals-recalculate-complete",b),window.wcTracks.recordEvent("order_edit_recalc_totals",{order_id:m.post_id,OK_cancel:"OK",status:a("#order_status").val()});var c=a(".usaepaytransapi_coupon_code").val(),h={action:"woocommerce_remove_order_coupon",dataType:"json",country:d,state:e,postcode:f,city:g,order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,coupon:c};""!=c?(console.log("remove coupon"),console.log(a(".usaepaytransapi_coupon_code").val()),a.post(woocommerce_admin_meta_boxes.ajax_url,h,function(b){if(b.success)if(a("#woocommerce-order-items").find(".inside").empty(),a("#woocommerce-order-items").find(".inside").append(b.data.html),""!=c){console.log("add coupon"),console.log(a(".usaepaytransapi_coupon_code").val());var h=a("#customer_user").val(),i=a("#_billing_email").val(),j={action:"woocommerce_add_coupon_discount",dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce,country:d,state:e,postcode:f,city:g,coupon:c,user_id:h,user_email:i};console.log(j),a.ajax({url:woocommerce_admin_meta_boxes.ajax_url,data:j,type:"POST",success:function(b){b.success?(a("#woocommerce-order-items").find(".inside").empty(),a("#woocommerce-order-items").find(".inside").append(b.data.html)):window.alert(b.data.error)},complete:function(){a("#woocommerce-order-items").unblock(),window.wcTracks.recordEvent("order_edit_added_coupon",{order_id:j.order_id,status:a("#order_status").val()})}})}else a("#woocommerce-order-items").unblock();else window.alert(b.data.error)})):a("#woocommerce-order-items").unblock()}})}})}})}})})}(jQuery);